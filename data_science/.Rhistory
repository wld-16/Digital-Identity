)
simulatedfkfGuanglongAccelerationModel = fkf(
a0 = processAccelerationModel$x[,1],
P0  = processAccelerationModel$P,
#dt = matrix(data = c(0,0,0, -abs(9.81) * Ts**2/2, -abs(9.81) * Ts ,1,0,0,0), nrow = 9, ncol = 1),
dt = matrix(data = c(0,0,0, 0,0,0,0,0,0), nrow = 9, ncol = 1),
ct = matrix(data = 0, nrow = 6, ncol = 1),
GGt = diag(x= c(1,1,1,1,1,1)),
Zt = processAccelerationModel$H,
Tt = array(as.numeric(unlist(lapply(1:simulatedMax,acceleration_simulation_transition_at_index))), dim=c(9, 9, simulatedMax)),
HHt = processAccelerationModel$Q,
yt = matrix(data = c(
simulationAccelerationMeasurementsAsMatrix[1,],
simulationAccelerationMeasurementsAsMatrix[2,],
simulationAccelerationMeasurementsAsMatrix[3,],
simulationAccelerationMeasurementsAsMatrix[4,],
simulationAccelerationMeasurementsAsMatrix[5,],
simulationAccelerationMeasurementsAsMatrix[6,]
), nrow = 6, ncol = simulatedMax, byrow = TRUE)
)
sim_time = c(1:simulatedMax)
sim_time = sim_time * 0.014
plot(simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_w state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[1,1,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[1,1,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_w state"), lwd = 3, col = c("blue"))
plot(simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_x state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[2,2,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[2,2,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_x state"), lwd = 3, col = c("blue"))
plot(simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_y state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[3,3,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[3,3,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_y state"), lwd = 3, col = c("blue"))
plot(simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_z state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[4,4,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[4,4,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_z state"), lwd = 3, col = c("blue"))
plot(simulationOrientationMeasurementsAsMatrix[1,] ~ sim_time, pch  = 20, main = "v_x in simulation", ylab = "v_x", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[5,5,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[5,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[5,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[5,5,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[5,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationOrientationMeasurementsAsMatrix[1,] ~ sim_time)
legend("bottomright", legend = c("v_x state", "simulated vx"), lwd = 3, col = c("blue", "black"))
plot(simulationOrientationMeasurementsAsMatrix[2,] ~ sim_time, pch  = 20, main = "v_y in simulation", ylab = "v_y", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[6,6,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[6,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[6,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[6,6,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[6,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationOrientationMeasurementsAsMatrix[2,] ~ sim_time)
legend("bottomright", legend = c("v_y state", "simulated v_y"), lwd = 3, col = c("blue", "black"))
plot(simulationOrientationMeasurementsAsMatrix[3,] ~ sim_time, pch  = 20, main = "v_z in simulation", ylab = "v_z", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[7,7,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[7,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[7,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[7,7,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[7,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationOrientationMeasurementsAsMatrix[3,] ~ sim_time)
legend("bottomright", legend = c("v_z state", "simulated v_z"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[1,] ~ sim_time, pch  = 20, main = "p_x in simulation", ylab = "p_x", xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[1,1,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[1,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[1,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[1,1,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[1,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[1,] ~ sim_time)
legend("bottomright", legend = c("p_x state", "simulated px"), lwd = 3, col = c("blue", "black"))
plot(simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax] ~ sim_time, pch  = 20, main = "v_x in simulation", ylab = "v_x",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[2,2,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[2,2,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("v_y state"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[2,] ~ sim_time, pch  = 20, main = "a_x in simulation", ylab = "a_x", xlab="time", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[3,3,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[3,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[3,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[3,3,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[3,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[2,] ~ sim_time)
legend("bottomright", legend = c("a_x state", "simulated ax"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[3,] ~ sim_time, pch  = 20, main = "p_y in simulation", ylab = "p_y",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[4,4,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[4,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[4,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[4,4,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[4,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[3,] ~ sim_time)
legend("bottomright", legend = c("p_y state", "simulated py"), lwd = 3, col = c("blue", "black"))
plot(simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax] ~ sim_time, pch  = 20, main = "v_y in simulation", ylab = "v_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[5,5,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[5,5,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("v_y state"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[4,] ~ sim_time, pch  = 20, main = "a_y in simulation", ylab = "a_y",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[6,6,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[6,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[6,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[6,6,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[6,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[4,] ~ sim_time)
legend("bottomright", legend = c("a_y state", "simulated ay"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[5,] ~ sim_time, pch  = 20, main = "p_z in simulation", ylab = "p_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[7,7,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[7,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[7,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[7,7,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[7,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[5,] ~ sim_time)
legend("bottomright", legend = c("p_z state", "simulated pz"), lwd = 3, col = c("blue", "black"))
plot(simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax] ~ sim_time, pch  = 20, main = "v_z in simulation", ylab = "v_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[8,8,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[8,8,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("v_z state"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[6,] ~ sim_time, pch  = 20, main = "a_z in simulation", ylab = "a_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[9,9,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[9,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[9,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[9,9,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[9,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[6,] ~ sim_time)
legend("bottomright", legend = c("a_z state", "simulated az"), lwd = 3, col = c("blue", "black"))
#plot(simulatedfkfGuanglongAccelerationModel, type = "resid.qq")
#plot(simulatedfkfGuanglongAccelerationModel, type = "acf", na.action = na.pass)
#install.packages("RMThreshold")
#install.packages("jsonlite")
#install.packages("ggplot2")
#install.packages("dplyr")
#install.packages("patchwork")
#install.packages("reshape2")
#install.packages("RSpincalc")
#install.packages("LaplacesDemon")
#install.packages('Rcpp')
#install.packages('KFK')
#install.packages("shiny")
library(shiny)
library(dplyr)
library(RMThreshold)
library(ggplot2)
library(RSpincalc)
library(reshape2)
library(LaplacesDemon)
library(Rcpp)
library(FKF)
source(paste(params$base_import_path, "/scripts/functions.R",sep=""))
Ts = params$T_s
# Will need euler angle velocity sensor
# TODO: Quaternions need to be normalized
# TODO: Transformationsmatrix berechnen für acceleration modell ?
source(paste(params$base_import_path, "/scripts/models.R",sep=""))
initial_orientation_state = c(
params$x_initial_state_q0,
params$x_initial_state_q1,
params$x_initial_state_q2,
params$x_initial_state_q3,
params$x_initial_state_euler_vx,
params$x_initial_state_euler_vy,
params$x_initial_state_euler_vz
)
initial_orientation_belief = diag(
c(
params$initial_belief_00_q0,
params$initial_belief_11_q1,
params$initial_belief_22_q2,
params$initial_belief_33_q3,
params$initial_belief_44_euler_vx,
params$initial_belief_55_euler_vy,
params$initial_belief_66_euler_vz
)
)
orientation_process_noise = data.frame(
vx = params$process_noise_orientation_angular_velocity_sigma_x,
vy = params$process_noise_orientation_angular_velocity_sigma_y,
vz = params$process_noise_orientation_angular_velocity_sigma_z
)
orientation_sensor_noise = data.frame(
vx = params$sensor_noise_imu_euler_velocity_x,
vy = params$sensor_noise_imu_euler_velocity_y,
vz = params$sensor_noise_imu_euler_velocity_z
)
#
processOrientationModel = getGuanglongOrientationModel(initial_orientation_state, initial_orientation_belief, orientation_process_noise, orientation_sensor_noise)
## only for simulation
rotationMatrix = quaternion_rotation_matrix(1,0,0,0)
##
initial_matrixHandToLocal = data.frame(
mx_x = rotationMatrix[1,1], my_x = rotationMatrix[1,2], mz_x = rotationMatrix[1,3],
mx_y = rotationMatrix[2,1], my_y = rotationMatrix[2,2], mz_y = rotationMatrix[2,3],
mx_z = rotationMatrix[3,1], my_z = rotationMatrix[3,2], mz_z = rotationMatrix[3,3]
)
initial_gravity = data.frame(
x = 0,
y = 0,
z = 9.81
)
## only for simulation
initial_gravity = data.frame(
x = 0,
y = 0,
z = 9.81
)
##
initial_acceleration_state = c(
params$x_initial_state_px,
params$x_initial_state_vx,
params$x_initial_state_ax,
params$x_initial_state_py,
params$x_initial_state_vy,
params$x_initial_state_ay,
params$x_initial_state_pz,
params$x_initial_state_vz,
params$x_initial_state_az
)
initial_acceleration_belief = diag(c(
params$initial_belief_px_00,
params$initial_belief_vx_11,
params$initial_belief_ax_22,
params$initial_belief_py_33,
params$initial_belief_vy_44,
params$initial_belief_ay_55,
params$initial_belief_pz_66,
params$initial_belief_vz_77,
params$initial_belief_az_88
))
acceleration_process_noise = data.frame(
x = params$process_noise_acceleration_noise_omega_x,
y = params$process_noise_acceleration_noise_omega_y,
z = params$process_noise_acceleration_noise_omega_z
)
acceleration_sensor_noise = data.frame(
x = params$sensor_noise_kinect_sigma_x,
y = params$sensor_noise_kinect_sigma_y,
z = params$sensor_noise_kinect_sigma_z,
ax = params$sensor_noise_imu_sigma_x,
ay = params$sensor_noise_imu_sigma_y,
az = params$sensor_noise_imu_sigma_z
)
processAccelerationModel = getGuanglongAccelerationModel(initial_acceleration_state, initial_acceleration_belief, initial_matrixHandToLocal, initial_gravity, acceleration_process_noise, acceleration_sensor_noise)
# Simulation of orientation
simulatedMax = 300
simulation_rotation_quaternion = data.frame(
w = array(data = 1, dim = simulatedMax),
x = array(data = 0, dim = simulatedMax),
y = array(data = 0, dim = simulatedMax),
z = array(data = 0, dim = simulatedMax)
)
orientation_process_noise = data.frame(
vx = params$process_noise_orientation_angular_velocity_sigma_x,
vy = params$process_noise_orientation_angular_velocity_sigma_y,
vz = params$process_noise_orientation_angular_velocity_sigma_z
)
simulation_orientation_process_noise = data.frame(
vx = 0.5,
vy = 0.5,
vz = 0.5
)
simulation_orientation_sensor_noise = data.frame(
vx = 0.05,
vy = 0.05,
vz = 0.05
)
simulation_acceleration_process_noise = data.frame(
x = 0.1,
y = 0.1,
z = 0.1
)
simulation_acceleration_sensor_noise = data.frame(
x = 0.01,
y = 0.01,
z = 0.01,
ax = 0.01,
ay = 0.01,
az = 0.01
)
source(paste(params$base_import_path, "/scripts/simulation.R",sep=""))
# Simulation Data for Orientation
setOrientationSimulationModell(processOrientationModel)
setOrientationSimulationProcessNoise(simulation_orientation_process_noise)
setOrientationSimulationSensorNoise(simulation_orientation_sensor_noise)
x_k = as.double(initial_orientation_state)
simulationOrientationData = Reduce(x = lapply(1:simulatedMax, justReturn, x_k), f=generateNextOrientationFrame, accumulate = TRUE)
simulationOrientationMeasurements = lapply(simulationOrientationData, generateNextOrientationMeasurement)
simulatedOrientationDataAsMatrix = matrix(data = unlist(simulationOrientationData), nrow = 7, ncol=simulatedMax)
simulationOrientationMeasurementsAsMatrix = matrix(data = unlist(simulationOrientationMeasurements), nrow = 3, ncol=simulatedMax)
simulated_normalized_quaternions = matrix(data = c(simulatedOrientationDataAsMatrix[1,], simulatedOrientationDataAsMatrix[2,], simulatedOrientationDataAsMatrix[3,], simulatedOrientationDataAsMatrix[4,]), nrow = simulatedMax, ncol=4)
# Simulation Data for Position
setAccelerationSimulationModell(processAccelerationModel)
setAccelerationSimulationProcessNoise(simulation_acceleration_process_noise)
setAccelerationSimulationSensorNoise(simulation_acceleration_sensor_noise)
x_k = as.double(initial_acceleration_state)
# With gravity
simulationAccelerationData = Reduce(x = lapply(1:simulatedMax, justReturn,x_k), f=generateNextAccelerationFrameWithGravity, accumulate = TRUE)
# without gracity
#simulationAccelerationData = Reduce(x = lapply(1:simulatedMax, justReturn,x_k), f=generateNextAccelerationFrame, accumulate = TRUE)
simulationAccelerationMeasurements = lapply(simulationAccelerationData, generateNextAccelerationMeasurement)
simulatedDataAccAsMatrix = matrix(data = unlist(simulationAccelerationData), nrow = 9, ncol=simulatedMax)
simulationAccelerationMeasurementsAsMatrix = matrix(data = unlist(simulationAccelerationMeasurements), nrow = 6, ncol=simulatedMax)
simulatedfkfGuanglongOrientationModel = fkf(
a0 = processOrientationModel$x[,1],
P0 = processOrientationModel$P,
dt = matrix(data = 0, nrow = 7, ncol = 1),
ct = matrix(data = 0, nrow = 3, ncol = 1),
GGt = diag(nrow = 3, ncol = 3),
Zt = processOrientationModel$H,
Tt = array(as.numeric(unlist(lapply(1:simulatedMax,simulated_orientation_transition_at_index))), dim=c(7, 7, simulatedMax)),
HHt = processOrientationModel$Q,
yt = matrix(data = c(
simulationOrientationMeasurementsAsMatrix[1,],
simulationOrientationMeasurementsAsMatrix[2,],
simulationOrientationMeasurementsAsMatrix[3,]
), nrow = 3, ncol = simulatedMax, byrow = TRUE)
)
simulatedfkfGuanglongAccelerationModel = fkf(
a0 = processAccelerationModel$x[,1],
P0  = processAccelerationModel$P,
#dt = matrix(data = c(0,0,0, -abs(9.81) * Ts**2/2, -abs(9.81) * Ts ,1,0,0,0), nrow = 9, ncol = 1),
dt = matrix(data = c(0,0,0, 0,0,0,0,0,0), nrow = 9, ncol = 1),
ct = matrix(data = 0, nrow = 6, ncol = 1),
GGt = diag(x= c(1,1,1,1,1,1)),
Zt = processAccelerationModel$H,
Tt = array(as.numeric(unlist(lapply(1:simulatedMax,acceleration_simulation_transition_at_index))), dim=c(9, 9, simulatedMax)),
HHt = processAccelerationModel$Q,
yt = matrix(data = c(
simulationAccelerationMeasurementsAsMatrix[1,],
simulationAccelerationMeasurementsAsMatrix[2,],
simulationAccelerationMeasurementsAsMatrix[3,],
simulationAccelerationMeasurementsAsMatrix[4,],
simulationAccelerationMeasurementsAsMatrix[5,],
simulationAccelerationMeasurementsAsMatrix[6,]
), nrow = 6, ncol = simulatedMax, byrow = TRUE)
)
sim_time = c(1:simulatedMax)
sim_time = sim_time * 0.014
plot(simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_w state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[1,1,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[1,1,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[1,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_w state"), lwd = 3, col = c("blue"))
plot(simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_x state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[2,2,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[2,2,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[2,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_x state"), lwd = 3, col = c("blue"))
plot(simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_y state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[3,3,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[3,3,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[3,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_y state"), lwd = 3, col = c("blue"))
plot(simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax] ~ sim_time, pch  = 20, main = "q_z state", ylab = "value normalized", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[4,4,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[4,4,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[4,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("q_z state"), lwd = 3, col = c("blue"))
plot(simulationOrientationMeasurementsAsMatrix[1,] ~ sim_time, pch  = 20, main = "v_x in simulation", ylab = "v_x", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[5,5,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[5,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[5,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[5,5,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[5,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationOrientationMeasurementsAsMatrix[1,] ~ sim_time)
legend("bottomright", legend = c("v_x state", "simulated vx"), lwd = 3, col = c("blue", "black"))
plot(simulationOrientationMeasurementsAsMatrix[2,] ~ sim_time, pch  = 20, main = "v_y in simulation", ylab = "v_y", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[6,6,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[6,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[6,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[6,6,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[6,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationOrientationMeasurementsAsMatrix[2,] ~ sim_time)
legend("bottomright", legend = c("v_y state", "simulated v_y"), lwd = 3, col = c("blue", "black"))
plot(simulationOrientationMeasurementsAsMatrix[3,] ~ sim_time, pch  = 20, main = "v_z in simulation", ylab = "v_z", xlab="time in seconds", type='l', ylim=c(-5,5))
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongOrientationModel$Ptt[7,7,1:simulatedMax] + simulatedfkfGuanglongOrientationModel$att[7,1:simulatedMax], rev(simulatedfkfGuanglongOrientationModel$att[7,1:simulatedMax] - simulatedfkfGuanglongOrientationModel$Ptt[7,7,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongOrientationModel$att[7,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationOrientationMeasurementsAsMatrix[3,] ~ sim_time)
legend("bottomright", legend = c("v_z state", "simulated v_z"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[1,] ~ sim_time, pch  = 20, main = "p_x in simulation", ylab = "p_x", xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[1,1,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[1,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[1,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[1,1,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[1,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[1,] ~ sim_time)
legend("bottomright", legend = c("p_x state", "simulated px"), lwd = 3, col = c("blue", "black"))
plot(simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax] ~ sim_time, pch  = 20, main = "v_x in simulation", ylab = "v_x",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[2,2,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[2,2,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[2,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("v_y state"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[2,] ~ sim_time, pch  = 20, main = "a_x in simulation", ylab = "a_x", xlab="time", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[3,3,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[3,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[3,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[3,3,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[3,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[2,] ~ sim_time)
legend("bottomright", legend = c("a_x state", "simulated ax"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[3,] ~ sim_time, pch  = 20, main = "p_y in simulation", ylab = "p_y",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[4,4,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[4,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[4,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[4,4,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[4,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[3,] ~ sim_time)
legend("bottomright", legend = c("p_y state", "simulated py"), lwd = 3, col = c("blue", "black"))
plot(simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax] ~ sim_time, pch  = 20, main = "v_y in simulation", ylab = "v_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[5,5,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[5,5,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[5,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("v_y state"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[4,] ~ sim_time, pch  = 20, main = "a_y in simulation", ylab = "a_y",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[6,6,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[6,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[6,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[6,6,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[6,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[4,] ~ sim_time)
legend("bottomright", legend = c("a_y state", "simulated ay"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[5,] ~ sim_time, pch  = 20, main = "p_z in simulation", ylab = "p_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[7,7,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[7,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[7,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[7,7,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[7,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[5,] ~ sim_time)
legend("bottomright", legend = c("p_z state", "simulated pz"), lwd = 3, col = c("blue", "black"))
plot(simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax] ~ sim_time, pch  = 20, main = "v_z in simulation", ylab = "v_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[8,8,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[8,8,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[8,1:simulatedMax] ~ sim_time, col = "blue")
legend("bottomright", legend = c("v_z state"), lwd = 3, col = c("blue", "black"))
plot(simulationAccelerationMeasurementsAsMatrix[6,] ~ sim_time, pch  = 20, main = "a_z in simulation", ylab = "a_z",xlab="time in seconds", type='l')
polygon(
x = c(sim_time, rev(sim_time)),
y = c(simulatedfkfGuanglongAccelerationModel$Ptt[9,9,1:simulatedMax] + simulatedfkfGuanglongAccelerationModel$att[9,1:simulatedMax], rev(simulatedfkfGuanglongAccelerationModel$att[9,1:simulatedMax] - simulatedfkfGuanglongAccelerationModel$Ptt[9,9,1:simulatedMax] )),
col = "lightsteelblue",
border = NA)
lines(simulatedfkfGuanglongAccelerationModel$att[9,1:simulatedMax] ~ sim_time, col = "blue")
lines(simulationAccelerationMeasurementsAsMatrix[6,] ~ sim_time)
legend("bottomright", legend = c("a_z state", "simulated az"), lwd = 3, col = c("blue", "black"))
#plot(simulatedfkfGuanglongAccelerationModel, type = "resid.qq")
#plot(simulatedfkfGuanglongAccelerationModel, type = "acf", na.action = na.pass)
knit_with_parameters("D:/Projekte/Digital-Identity/data_science/workbooks/notebook_guanglong_simulation.Rmd", encoding = "UTF-8")
library(shiny)
knit_with_parameters("D:/Projekte/Digital-Identity/data_science/workbooks/notebook_guanglong_simulation.Rmd", encoding = "UTF-8")
